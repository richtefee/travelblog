{{/* article-pagination.html */}}
{{ if .Params.showPagination | default (.Site.Params.article.showPagination | default true) }}

  {{/* 1. Collect all index.md pages under posts/ recursively */}}
  {{ $allPages := slice }}
  {{ range .Site.RegularPages }}
    {{ if and (strings.HasPrefix .File.Dir "posts") (eq .File.BaseFileName "index") }}
      {{ $allPages = $allPages | append . }}
    {{ end }}
  {{ end }}

  {{/* 2. Sort all pages by date ascending */}}
  {{ $allPages = sort $allPages "Date" "asc" "RelPermalink" "asc" }}

  {{/* 3. Find the index of the current page */}}
  {{ $currentIndex := -1 }}
  {{ $currentPage := . }}
  {{ range $i, $p := $allPages }}
    {{ if eq $p.RelPermalink $currentPage.RelPermalink }}
      {{ $currentIndex = $i }}
    {{ end }}
  {{ end }}

  {{/* 4. Determine previous and next pages */}}
  {{ $customPrev := cond (gt $currentIndex 0) (index $allPages (sub $currentIndex 1)) nil }}
  {{ $customNext := cond (lt $currentIndex (sub (len $allPages) 1)) (index $allPages (add $currentIndex 1)) nil }}

  {{/* 5. Render pagination using original Blowfish HTML, replacing .NextInSection / .PrevInSection */}}
  {{ if or $customPrev $customNext }}
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600">
      <div class="flex justify-between pt-3">

        <span class="flex flex-col">
          {{ if $customPrev }}
            <a
              class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
              href="{{ $customPrev.RelPermalink }}">
              <span class="leading-6">
                <span class="inline-block rtl:rotate-180">&larr;</span>&ensp;{{ $customPrev.Title | emojify }}
              </span>
            </a>
            {{ if .Params.showDate | default (.Site.Params.article.showDate | default true) }}
              <span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400">
                {{ partial "meta/date.html" $customPrev.Date }}
              </span>
            {{ end }}
          {{ end }}
        </span>

        <span class="flex flex-col items-end">
          {{ if $customNext }}
            <a
              class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
              href="{{ $customNext.RelPermalink }}">
              <span class="leading-6">
                {{ $customNext.Title | emojify }}&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
              </span>
            </a>
            {{ if .Params.showDate | default (.Site.Params.article.showDate | default true) }}
              <span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400">
                {{ partial "meta/date.html" $customNext.Date }}
              </span>
            {{ end }}
          {{ end }}
        </span>

      </div>
    </div>
  {{ end }}

{{ end }}
